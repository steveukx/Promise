/*! promise-lite 2013-06-16 */
!function(a,b){"undefined"!=typeof module&&module.exports?module.exports=b(require("subscribable")):"function"==typeof define&&define.amd?define(["subscribable"],b):a.Promise=b(a.Subscribable)}(this,function(a){"use strict";function b(){a.prepareInstance(this)}return b.delay="object"==typeof process&&process.nextTick?function(a,b,c){process.nextTick(function(){a.call(b,c)})}:function(a,b,c){window.setTimeout(function(){a.call(b,c)},0)},b.PENDING="waiting...",b.SUCCESS="a-okay!",b.FAILURE="there was a problem :os",b.callNext=function(a,c){return"function"==typeof a&&b.delay(a,c,this._result),this},b.empty=function(){return this},b.prototype._status=b.PENDING,b.prototype._on=function(a,b,c){return b&&b instanceof Function&&this.on(a,b,c),this},b.prototype.isResolved=function(){return this._status===b.SUCCESS},b.prototype.isRejected=function(){return this._status===b.FAILURE},b.prototype.isPending=function(){return this._status===b.PENDING},b.prototype.done=function(a,c){return this._on(b.SUCCESS,a,c)},b.prototype.fail=function(a,c){return this._on(b.FAILURE,a,c)},b.prototype.always=function(a,b){return this.done(a,b).fail(a,b)},b.prototype.then=function(a,c,d,e){if("function"!=typeof a)throw new TypeError("Promise.then must have a function as the first argument");!e&&"function"!=typeof arguments[arguments.length-1]&&arguments[arguments.length-1]&&(e=arguments[arguments.length-1]),this.fail(c,e).progress(d,e);var f=new b;return this.done(function(){var c,d;try{c=a.apply(e,arguments)}catch(g){d=g}d?f.reject(d):c instanceof b?c.pipeTo(f):f.resolve(c)}),f},b.prototype._complete=function(a,c){return this._status==b.PENDING&&(this._result=c,this._status=a,this.fire(a,c),this.un(),this.done=a===b.SUCCESS?b.callNext:b.empty,this.fail=a===b.FAILURE?b.callNext:b.empty,this.always=b.callNext,this.progress=b.empty,this.notify=this.reject=this.resolve=b.empty),this},b.prototype.resolve=function(a){return this._complete.call(this,b.SUCCESS,a)},b.prototype.reject=function(a){return this._complete.call(this,b.FAILURE,a)},b.prototype.notify=function(a){return this.fire(b.PENDING,a),this},b.prototype.progress=function(a,c){return this._on(b.PENDING,a,c)},b.prototype.pipe=function(a,c,d){return this.pipeTo(new b,a,c,d)},b.prototype.pipeTo=function(a,c,d,e){return a instanceof b&&this.then(function(b){a.resolve(c?c(b):b)},function(b){a.reject(d?d(b):b)},function(b){a.notify(e?e(b):b)}),a},b.Promise=b,b});